#!/bin/sh

# Run an experiment using run-geolocate-twitter, sending its output to a
# unique file and using 'nohup' so that exiting the session won't kill a
# background script.
#
# Allow -i STR or --id STR to be specified at the beginning of the options,
# specifying an ID to use in the outfiles.

if [ -z "$TEXTGROUNDER_DIR" ]; then
  echo "Must set TEXTGROUNDER_DIR to top level of TextGrounder distribution"
  exit 1
fi

RUN_GEOLOCATE_TWITTER="$TEXTGROUNDER_DIR/bin/run-geolocate-twitter"

if [ "$1" = "-i" -o "$1" = "--id" ]; then
  ID=".$2"
  shift 2
fi

if [ "`uname`" = "Darwin" ]; then
  # Darwin (BSD) is missing all sorts of stuff, naturally, including %P,
  # which gets you lowercase am or pm. (%p gets you uppercase AM or PM --
  # real logical, huh?)
  OUTFILE="run-geolocate-twitter.out$ID.`date '+%F.%H%M%p'`"
else
  OUTFILE="run-geolocate-twitter.out$ID.`date '+%F.%H%M%P'`"
fi
if [ -e "$OUTFILE" ]; then
  echo "Output file $OUTFILE already exists!  Won't overwrite."
  exit 1
fi

echo "Running on `hostname` at time `date`"
echo "Outputting to $OUTFILE"
if [ -n "$1" ]; then
  echo "Arguments are" ${1+"$@"}
else
  echo "Run without arguments"
fi

nohup $RUN_GEOLOCATE_TWITTER ${1+"$@"} > $OUTFILE 2>&1
