#!/bin/sh

# Run geolocation, passing it various useful arguments for running
# on Eisenstein et al (2010)'s Twitter data.  Extra arguments
# can be specified on the command line, which will override any existing
# arguments.
#
# See also 'nohup-geolocate-twitter', which will run this script using
# 'nohup' while saving the output to a file.

if [ -z "$TEXTGROUNDER_DIR" ]; then
  echo "Must set TEXTGROUNDER_DIR to top level of TextGrounder distribution"
  exit 1
fi

. $TEXTGROUNDER_DIR/bin/config-geolocate

####### Begin option processing

#opts=""

# Don't bother using getopt here.  Less portable (esp. on Mac OS X, where
# the default getopt doesn't support --long format), and hardly buys us
# much anything.

RUN_PROG=tg-geolocate
GEOTEXT_OUTPUT_DIR="$TG_TWITTER_DIR/output-5-docthresh"

while true ; do
  case "$1" in
    --doc-thresh) GEOTEXT_OUTPUT_DIR="$TG_TWITTER_DIR/output-$2-docthresh" ;
                  shift 2 ;;
    # A no-argument option ....
    #-n|--no-backup) opts="$opts --no-backup" ; shift ;;
    --run-prog ) RUN_PROG="$2"; shift 2 ;;
    --) shift ; break ;;
    *) break ;;
  esac
done

TG_GEOLOCATE="$TEXTGROUNDER_DIR/bin/$RUN_PROG"

####### End option processing


GEOTEXT_PREFIX="$GEOTEXT_OUTPUT_DIR/geotext-twitter"

COMBINED_ARTICLE_DATA_ARG="--article-data-file $GEOTEXT_PREFIX-combined-article-data.txt"
COUNTS_ARG="--counts-file $GEOTEXT_PREFIX-counts-only-coord-articles.txt"

$TG_GEOLOCATE $COMBINED_ARTICLE_DATA_ARG $COUNTS_ARG ${1+"$@"}
