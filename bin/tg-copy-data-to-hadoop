#!/bin/sh

hadoop="echo_and_hadoop"
echo_and_hadoop()
{
  echo hadoop ${1+"$@"}
  hadoop ${1+"$@"}
}

help()
{
  cat <<FOO
Usage: $0 CORPUS

Copy corpus or TextGrounder data into Hadoop.

Currently recognized values for CORPUS:

wikipedia         Wikipedia corpus.
twitter           Twitter (GeoText) corpus.
textgrounder      TextGrounder data.
all               All of the above.

FOO
}

if [ -z "$*" ]; then
  help; exit 1
fi

if [ -z "$TEXTGROUNDER_DIR" ]; then
  echo "Must set TEXTGROUNDER_DIR to top level of TextGrounder distribution"
  exit 1
fi

. $TEXTGROUNDER_DIR/bin/config-geolocate

if [ "$*" = "all" ]; then
  steps="wikipedia twitter textgrounder"
else
  steps="$*"
fi

for step in $steps ; do
  if [ "$step" = textgrounder ]; then
    $hadoop fs -put "$TEXTGROUNDER_DIR/data" "$TG_HADOOP_DIR/data"
  elif [ "$step" = wikipedia ]; then
    WIKI_DATE="`echo $OUT_COMBINED_DOCUMENT_DATA_FILE | sed s/-combined-document-data.txt//`"
    for item in $TG_CORPUS_DIR/wikipedia/$WIKI_DATE/*
    do
        itembase=`basename $item`
        $hadoop fs -put $item "$TG_HADOOP_DIR/corpora/wikipedia/$WIKI_DATE/$itembase"
    done
  elif [ "$step" = twitter ]; then
    for x in $TG_CORPUS_DIR/twitter-geotext/docthresh-*; do
      dir=`basename $x`
      $hadoop fs -put $x "$TG_HADOOP_DIR/corpora/twitter-geotext/$dir"
    done
  else
    echo "Unrecognized corpus value: $step"
    help; exit 1
  fi
done
