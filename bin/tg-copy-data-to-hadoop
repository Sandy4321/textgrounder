#!/bin/sh

hadoop="echo hadoop"
help()
{
  cat <<FOO
Usage: $0 CORPUS

Copy corpus or TextGrounder data into Hadoop.

Currently recognized values for CORPUS:

wikipedia         Wikipedia corpus.
twitter           Twitter (GeoText) corpus.
textgrounder      TextGrounder data.
all               All of the above.

FOO
}

if [ -z "$*" ]; then
  help; exit 1
fi

if [ -z "$TEXTGROUNDER_DIR" ]; then
  echo "Must set TEXTGROUNDER_DIR to top level of TextGrounder distribution"
  exit 1
fi

. $TEXTGROUNDER_DIR/bin/config-geolocate

if [ "$*" = "all" ]; then
  steps="wikipedia twitter textgrounder"
else
  steps="$*"
fi

for step in $steps ; do
  if [ "$step" = textgrounder ]; then
    $hadoop fs -put "$TEXTGROUNDER_DIR/data" "$TG_HADOOP_DIR/data"
  elif [ "$step" = wikipedia ]; then
    $hadoop fs -put "$TG_WIKIPEDIA_DIR/$OUT_COMBINED_ARTICLE_DATA_FILE" "$TG_HADOOP_DIR/corpora/wikipedia/$OUT_COMBINED_ARTICLE_DATA_FILE"
    $hadoop fs -put "$TG_WIKIPEDIA_DIR/$OUT_COORD_COUNTS_FILE" "$TG_HADOOP_DIR/corpora/wikipedia/$OUT_COORD_COUNTS_FILE"
  elif [ "$step" = twitter ]; then
    for x in $TG_TWITTER_DIR/output-*-docthresh; do
      dir=`basename $x`
      $hadoop fs -put "$TG_TWITTER_DIR/$dir" "$TG_HADOOP_DIR/corpora/geotext/$dir"
    done
  else
    echo "Unrecognized corpus value: $step"
    help; exit 1
  fi
done
