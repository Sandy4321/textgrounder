#!/bin/sh

help()
{
  cat <<FOO
Usage: $0 [--hadoop] [--doc-thresh THRESH] CORPUS

Return arguments to use for running on CORPUS, a text corpus.

Currently recognized:

wikipedia         Run on Wikipedia (same as enwiki-20100905).
enwiki-20100905   Run on English Wikipedia dump from September 5, 2010.
enwiki-20111007   Run on English Wikipedia dump from October 7, 2011.
enwiki-*          Run on some other English Wikipedia dump.
twitter           Run on the GeoText twitter corpus.
twitter-wiki      Run on a combination of both of the above corpora.

For the Twitter corpora, THRESH specifies the document threshold controlling
which vocabulary items are discarded (items occurring in fewer than the
threshold number of documents are discarded, or more accurately substituted
with a generic out-of-vocabulary token).  This in turn controls which
version of the GeoText corpus is used.  Default is 5.

If --hadoop is given, different directories are used, since data is being
read from the Hadoop File System rather than locally.
FOO
}

if [ -z "$TEXTGROUNDER_DIR" ]; then
  echo "Must set TEXTGROUNDER_DIR to top level of TextGrounder distribution"
  exit 1
fi

docthresh=5
hadoop=

while true ; do
  case "$1" in
    --hadoop) hadoop=yes; shift ;;
    --doc-thresh) docthresh="$2"; shift 2 ;;
    --help) help; exit 1 ;;
    --) shift ; break ;;
    *) break ;;
  esac
done

if [ -z "$1" -o "$1" = help ]; then
  help; exit 1
fi

if [ -n "$hadoop" ]; then
  # If we're running under Hadoop, use a hierarchy in HDFS, by setting
  # the following variable.
  TG_USE_HDFS=yes
fi

. $TEXTGROUNDER_DIR/bin/config-geolocate

geotext_output_dir="$TG_TWITTER_DIR/output-$docthresh-docthresh"

output_args() {
  case "$1" in
    #wikipedia )
    #  echo --document-file $IN_COMBINED_DOCUMENT_DATA_FILE \
    #       --counts-file $IN_COORD_COUNTS_FILE ;;
    wikipedia )
      # Use the default version (usually enwiki-20100905)
      echo --input-corpus $WP_VERSION_DIR ;;
    enwiki-* )
      set_wp_version "$1"
      echo --input-corpus $WP_VERSION_DIR ;;
    twitter )
      echo --input-corpus $geotext_output_dir ;;
    twitter-wiki )
      output_args wikipedia; output_args twitter ;;
    * )
      echo "Unrecognized corpus type: $1"; echo ""; help; exit 1 ;;
  esac
}

for x in ${1+"$@"}; do
  output_args "$x"
done
